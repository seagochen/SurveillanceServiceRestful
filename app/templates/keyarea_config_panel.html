<div id="config-panel" class="keyarea-panel">
    <div class="panel-header">
        <h2>クライアント {{ magistrate_id }} - 重点エリア設定</h2>
    </div>

    <div class="keyarea-container">
        <!-- 左侧：不写死 width/height，让 CSS 控制 -->
        <div class="rtsp-view">
        <img id="keyarea-stream"
            src="/panel/keyarea/{{ magistrate_id }}/frame"
            alt="RTSP Stream">
        </div>

        <div class="config-area">
            <form id="keyarea-form" autocomplete="off">

                <fieldset class="config-fieldset">
                    <legend>キャリブレーション</legend>
                    <div class="button-group">
                        <button type="button">地面設定</button>
                        <button
                                type="button"
                                hx-get="/panel/keyarea/{{ magistrate_id }}/camera-settings"
                                hx-target="body"
                                hx-swap="beforeend"
                        >
                          カメラパラメータ設定
                        </button>
                    </div>
                </fieldset>

                <fieldset class="config-fieldset">
                    <legend>エリア操作</legend>
                    <div class="button-group">
                        <button type="button">重点エリアを設置</button>
                    </div>
                </fieldset>

                <div class="panel-footer" style="justify-content: flex-end;">
                    <button
                        type="button"
                        class="danger"
                        hx-get="/panel/magistrate/{{ magistrate_id }}"
                        hx-target="#config-panel"
                        hx-swap="outerHTML"
                    >
                        取り消し
                    </button>
                    <button
                        type="submit"
                        class="primary"
                        hx-post="/panel/keyarea/{{ magistrate_id }}"
                        hx-include="#keyarea-form"
                        hx-target="#config-panel"
                        hx-swap="outerHTML"
                    >
                        確認
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
window.addEventListener("beforeunload", function () {
    navigator.sendBeacon("/panel/keyarea/{{ magistrate_id }}/stop");
});
</script>

<style>
  .keyarea-container{
    display:grid;
    /* grid-template-columns: 640px 360px; */ /*  左 640px 画面、右 360px 面板 */
    grid-template-columns: 640px 1fr; /* 左侧固定640px画面，右侧填满剩余空间 */
    gap:24px;
    align-items:start;
  }

  /* 左侧画面：固定 640×480 */
  .rtsp-view{
    position:relative;
    width:640px; 
    height:480px;
    background:#000;
    border-radius:8px;
    overflow:hidden;
    box-shadow: 0 0 0 1px rgba(255,255,255,0.06) inset;
  }

  /* 画面铺满容器；比例不一致时做轻微裁切，不留黑边 */
  #keyarea-stream{
    position:absolute; inset:0;
    width:100%; height:100%;
/*   object-fit: cover; */
    object-fit: fill;   /* 或干脆删掉这一行，默认也是填充 */
    display:block;
  }
  
  /* .config-area{ width:360px; } */

  /* 右侧区域现在是自适应，不再固定宽度 */
  .config-area {
    width: auto;
    min-width: 360px;   /* 可以保留一个最小宽度，避免控件太窄 */
  }

  /* 窄屏时改为上下堆叠 */
  @media (max-width: 1200px){
    .keyarea-container{ grid-template-columns: 1fr; }
    /* .rtsp-view{ width:100%; height:auto; aspect-ratio:16/15; } */ /* 仍保持约 800×750 的比例 */
    /* 窄屏下保持 4:3，可自适应高度 */
    .rtsp-view{ width:100%; height:auto; aspect-ratio:4/3; }
    .config-area{ width:auto; }
    .config-area{ width:auto; }
    
  }

  .keyarea-panel .config-fieldset{ border:1px solid #555; border-radius:8px; padding:1.2em; margin-bottom:1.5em; }
  .keyarea-panel .config-fieldset legend{ padding:0 .5em; font-size:1.1em; font-weight:700; }
  .keyarea-panel .config-table{ width:100%; border-collapse:collapse; }
  .keyarea-panel .config-table td{ padding:8px; border-bottom:1px solid #444; }
  .button-group{ display:flex; gap:10px; }
</style>